/*
    Validform version 4.0
	By sean during April 7, 2010 - May 15, 2012
	For more information, please visit http://validform.rjboy.cn
	Validform is available under the terms of the MIT license.
*/

(function(d){var e=null,c,b=true,a={tit:"提示信息",w:"请输入正确信息！",r:"通过信息验证！",c:"正在检测信息…",s:"请填入信息！",v:"所填信息没有经过验证，请稍后…",p:"正在提交数据…",err:"出错了！请检查提交地址或返回数据格式是否正确！"},f=function(){if(d("#Validform_msg").length!==0){return false}c=d('<div id="Validform_msg"><div class="Validform_title">'+a.tit+'<a class="Validform_close" href="javascript:void(0);">&chi;</a></div><div class="Validform_info"></div><div class="iframe"><iframe frameborder="0" scrolling="no" height="100%" width="100%"></iframe></div></div>').appendTo("body");c.find("a.Validform_close").click(function(){c.hide();b=true;if(e){e.focus().addClass("Validform_error")}return false}).focus(function(){this.blur()});d(window).bind("scroll resize",function(){if(!b){var i=(d(window).width()-c.outerWidth())/2,h=(d(window).height()-c.outerHeight())/2,g=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)+(h>0?h:0);c.animate({left:i,top:g},{duration:400,queue:false})}})};d.Tipmsg=a;d.fn.Validform=function(g){var h={};g=d.extend({},d.fn.Validform.sn.defaults,g);g.datatype&&d.extend(d.Datatype,g.datatype);this.each(function(k){var n=d(this),j=false;n.find("[tip]").each(function(){var q=d(this).attr("tip");var p=d(this).attr("altercss");d(this).focus(function(){if(d(this).val()==q){d(this).val("");if(p){d(this).removeClass(p)}}}).blur(function(){if(d.trim(d(this).val())===""){d(this).val(q);if(p){d(this).addClass(p)}}})});n.find("input[recheck]").each(function(){var q=d(this);var p=n.find("input[name='"+d(this).attr("recheck")+"']");p.bind("keyup",function(){if(p.val()==q.val()&&p.val()!=""){if(p.attr("tip")){if(p.attr("tip")==p.val()){return false}}q.trigger("blur")}}).bind("blur",function(){if(p.val()!=q.val()&&q.val()!=""){if(q.attr("tip")){if(q.attr("tip")==q.val()){return false}}q.trigger("blur")}})});if(g.usePlugin){if(g.usePlugin.swfupload){var l=n.find("input[plugin='swfupload']").val(""),m={custom_settings:{form:n,showmsg:function(q,p){d.fn.Validform.sn.showmsg(q,g.tiptype,{obj:l,curform:n,type:p})}}};m=d.extend(true,{},g.usePlugin.swfupload,m);if(typeof(swfuploadhandler)!="undefined"){swfuploadhandler.init(m,k)}}if(g.usePlugin.datepicker){if(g.usePlugin.datepicker.format){Date.format=g.usePlugin.datepicker.format;delete g.usePlugin.datepicker.format}if(g.usePlugin.datepicker.firstDayOfWeek){Date.firstDayOfWeek=g.usePlugin.datepicker.firstDayOfWeek;delete g.usePlugin.datepicker.firstDayOfWeek}var o=n.find("input[plugin='datepicker']");g.usePlugin.datepicker.callback&&o.bind("dateSelected",function(){var p=new Date(d.event._dpCache[this._dpId].getSelected()[0]).asString(Date.format);g.usePlugin.datepicker.callback(p,this)});o.datePicker(g.usePlugin.datepicker)}if(g.usePlugin.passwordstrength){g.usePlugin.passwordstrength.showmsg=function(q,r,p){d.fn.Validform.sn.showmsg(r,g.tiptype,{obj:q,curform:n,type:p,sweep:g.tipSweep},"hide")};n.find("input[plugin*='passwordStrength']").passwordStrength(g.usePlugin.passwordstrength)}}n.find("[datatype]").blur(function(){var q=true;q=d.fn.Validform.sn.checkform(d(this),n,{type:g.tiptype,sweep:g.tipSweep},"hide");if(!q){return false}if(typeof(q)!="boolean"){d(this).removeClass("Validform_error");return false}q=d.fn.Validform.sn.regcheck(d(this).attr("datatype"),d(this).val(),d(this),n);if(!q){if(d(this).attr("ignore")==="ignore"&&(d(this).val()===""||d(this).val()===d(this).attr("tip"))){if(g.tiptype==2){var r=d(this).parent().next().find(".Validform_checktip");if(r.is(".Validform_right")){r.text("")}r.removeClass().addClass("Validform_checktip")}else{if(typeof g.tiptype=="function"){(g.tiptype)("",{obj:d(this),type:4},d.fn.Validform.sn.cssctl)}}q=true;e=null;return true}d.fn.Validform.sn.showmsg(d(this).attr("errormsg")||a.w,g.tiptype,{obj:d(this),curform:n,type:3,sweep:g.tipSweep},"hide")}else{if(d(this).attr("ajaxurl")){var s=d(this);var p=arguments[1];if(s.attr("valid")=="posting"){return false}s.attr("valid","posting");d.fn.Validform.sn.showmsg(a.c,g.tiptype,{obj:s,curform:n,type:1,sweep:g.tipSweep},"hide");d.ajax({type:"POST",url:s.attr("ajaxurl"),data:"param="+d(this).val()+"&name="+d(this).attr("name"),dataType:"text",success:function(t){if(d.trim(t)=="y"){s.attr("valid","true");d.fn.Validform.sn.showmsg(a.r,g.tiptype,{obj:s,curform:n,type:2,sweep:g.tipSweep},"hide");if(p==="postform"){n.trigger("submit")}}else{s.attr("valid",t);d.fn.Validform.sn.showmsg(t,g.tiptype,{obj:s,curform:n,type:3,sweep:g.tipSweep})}},error:function(){s.attr("valid",a.err);d.fn.Validform.sn.showmsg(a.err,g.tiptype,{obj:s,curform:n,type:3,sweep:g.tipSweep})}})}else{d.fn.Validform.sn.showmsg(a.r,g.tiptype,{obj:d(this),curform:n,type:2,sweep:g.tipSweep},"hide")}}});n.find(":checkbox[datatype],:radio[datatype]").each(function(){var q=d(this);var p=q.attr("name");n.find("[name='"+p+"']").filter(":checkbox,:radio").bind("click",function(){q.trigger("blur")})});var i=function(){g.beforeCheck&&g.beforeCheck(n);var p=true,q=true;if(j){return false}n.find("[datatype]").each(function(){q=d.fn.Validform.sn.checkform(d(this),n,{type:g.tiptype,sweep:g.tipSweep});if(!q){if(!g.showAllError){e.focus();p=false;return false}p&&(p=false);return true}if(typeof(q)!="boolean"){return true}q=d.fn.Validform.sn.regcheck(d(this).attr("datatype"),d(this).val(),d(this),n);if(q&&d(this).is("[datatype*='option_']")){d(this).trigger("blur")}if(!q){if(d(this).attr("ignore")==="ignore"&&(d(this).val()===""||d(this).val()===d(this).attr("tip"))){e=null;return true}d.fn.Validform.sn.showmsg(d(this).attr("errormsg")||a.w,g.tiptype,{obj:d(this),curform:n,type:3,sweep:g.tipSweep});if(!g.showAllError){e.focus();p=false;return false}p&&(p=false);return true}if(d(this).attr("ajaxurl")){if(d(this).attr("valid")!="true"){var r=d(this);d.fn.Validform.sn.showmsg(a.v,g.tiptype,{obj:r,curform:n,type:3,sweep:g.tipSweep});if(!b||g.tiptype!=1){setTimeout(function(){r.trigger("blur",["postform"])},1500)}if(!g.showAllError){p=false;return false}p&&(p=false);return true}else{d.fn.Validform.sn.showmsg(a.r,g.tiptype,{obj:d(this),curform:n,type:2,sweep:g.tipSweep},"hide")}}});if(g.showAllError){n.find(".Validform_error:first").focus()}if(p&&!j){e=null;if(g.postonce){j=true}g.beforeSubmit&&g.beforeSubmit(n);if(g.ajaxPost){d.fn.Validform.sn.showmsg(a.p,g.tiptype,{obj:n,curform:n,type:1,sweep:g.tipSweep},"alwaysshow");d.ajax({type:"POST",dataType:"json",url:n.attr("action"),data:n.serializeArray(),success:function(r){if(r.status==="y"){d.fn.Validform.sn.showmsg(r.info,g.tiptype,{obj:n,curform:n,type:2,sweep:g.tipSweep},"alwaysshow")}else{j=false;d.fn.Validform.sn.showmsg(r.info,g.tiptype,{obj:n,curform:n,type:3,sweep:g.tipSweep},"alwaysshow")}g.callback&&g.callback(r)},error:function(){j=false;d.fn.Validform.sn.showmsg(a.err,g.tiptype,{obj:n,curform:n,type:3,sweep:g.tipSweep},"alwaysshow")}});return false}else{g.callback?g.callback(n):n.get(0).submit()}}};g.btnSubmit&&n.find(g.btnSubmit).bind("click",i);n.submit(function(){i();return false});n.find("input[type='reset']").click(function(){n.find(".Validform_right").text("");n.find(".Validform_checktip").removeClass("Validform_wrong Validform_right Validform_loading");n.find(".Validform_error").removeClass("Validform_error");n.find("input:first").focus()})});if(g.tiptype==1||(g.tiptype==2&&g.ajaxPost)){f()}};d.fn.Validform.sn={defaults:{tiptype:1,tipSweep:false,showAllError:false,postonce:false,ajaxPost:false},toString:Object.prototype.toString,regcheck:function(l,m,h,n){if(this.toString.call(d.Datatype[l])=="[object Function]"){return(d.Datatype[l])(m,h,n)}if(!(l in d.Datatype)){var j=l.match(d.Datatype.match),o;reg:for(var g in d.Datatype){o=g.match(d.Datatype.match);if(!o){continue reg}if(j[1]===o[1]){var k=d.Datatype[g].toString();var i=new RegExp("\\{"+o[2]+","+o[3]+"\\}");k=k.replace(i,"{"+j[2]+","+j[3]+"}").replace(/^\//,"").replace(/\/$/,"");d.Datatype[l]=new RegExp(k);break reg}}}if(this.toString.call(d.Datatype[l])=="[object RegExp]"){return d.Datatype[l].test(m)}return false},showmsg:function(l,h,k,g){if(k.type==3&&!k.obj.is("form")){e=k.obj}else{e&&e.removeClass("Validform_error");e=null}e&&e.addClass("Validform_error");if(typeof h=="function"){if(!(k.sweep&&g=="hide")){h(l,k,this.cssctl)}return false}if(h==1||g=="alwaysshow"){c.find(".Validform_info").text(l)}if(h==1&&g!="hide"||g=="alwaysshow"){b=false;c.find(".iframe").css("height",c.outerHeight());var j=(d(window).width()-c.outerWidth())/2;var i=(d(window).height()-c.outerHeight())/2;i=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)+(i>0?i:0);c.css({left:j}).show().animate({top:i},100)}if(h==2&&k.obj){k.obj.parent().next().find(".Validform_checktip").text(l);this.cssctl(k.obj.parent().next().find(".Validform_checktip"),k.type)}},checkform:function(k,j,g,o){var l=k.attr("errormsg")||a.w,i;if(k.is("[datatype='radio']")){i=k.attr("name");var n=j.find(":radio[name='"+i+"']:checked").val();if(!n){this.showmsg(l,g.type,{obj:k,curform:j,type:3,sweep:g.sweep},o);return false}this.showmsg(a.r,g.type,{obj:k,curform:j,type:2,sweep:g.sweep},"hide");return"radio"}if(k.is("[datatype='checkbox']")){i=k.attr("name");var m=j.find(":checkbox[name='"+i+"']:checked").val();if(!m){this.showmsg(l,g.type,{obj:k,curform:j,type:3,sweep:g.sweep},o);return false}this.showmsg(a.r,g.type,{obj:k,curform:j,type:2,sweep:g.sweep},"hide");return"checkbox"}if(k.is("[datatype='select']")){if(!k.val()){this.showmsg(l,g.type,{obj:k,curform:j,type:3,sweep:g.sweep},o);return false}this.showmsg(a.r,g.type,{obj:k,curform:j,type:2,sweep:g.sweep},"hide");return"select"}if(k.is("[datatype*='option_']")){k.removeClass("Validform_error");e=null;return true}var p=k.attr("tip");if((d.trim(k.val())===""||k.val()===p)&&k.attr("ignore")!="ignore"){this.showmsg(k.attr("nullmsg")||a.s,g.type,{obj:k,curform:j,type:3,sweep:g.sweep},o);return false}if(k.attr("recheck")){var h=j.find("input[name='"+k.attr("recheck")+"']:first");if(k.val()!=h.val()){this.showmsg(l,g.type,{obj:k,curform:j,type:3,sweep:g.sweep},o);return false}this.showmsg(a.r,g.type,{obj:k,curform:j,type:2,sweep:g.sweep},"hide")}k.removeClass("Validform_error");e=null;return true},cssctl:function(h,g){switch(g){case 1:h.removeClass("Validform_right Validform_wrong").addClass("Validform_checktip Validform_loading");break;case 2:h.removeClass("Validform_wrong Validform_loading").addClass("Validform_checktip Validform_right");break;case 4:h.removeClass("Validform_right Validform_wrong Validform_loading").addClass("Validform_checktip");break;default:h.removeClass("Validform_right Validform_loading").addClass("Validform_checktip Validform_wrong")}}};d.Showmsg=function(g){f();d.fn.Validform.sn.showmsg(g,1,{})};d.Hidemsg=function(){c.hide();b=true};d.Datatype={match:/^(.+?)(\d+)-(\d+)$/,"*":/.+/,"*6-16":/^.{6,16}$/,n:/^\d+$/,"n6-16":/^\d{6,16}$/,s:/^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]+$/m,"s6-18":/^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]{6,18}$/,p:/^[0-9]{6}$/,m:/^13[0-9]{9}$|15[0-9]{9}$|18[0-9]{9}$/,e:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,url:/^(\w+:\/\/)?\w+(\.\w+)+$/}})(jQuery);
